name: pr-deps-plotter
description: '✏️  Draw diagrams representing pull request dependencies.'
inputs:
  PR_URL:
    description: 'The URL to the pull request whose dependency tree to analyze.'
    required: true
  TOKEN:
    description: 'GitHub token to authenticate the action.'
    required: true
outputs:
  SVG:
    description: 'The SVG output generated by running the action. Represents a graphic which will be posted in the initial PR as a comment.'
runs:
  using: composite
  steps:
    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.17

    - name: Verify dependencies
      shell: bash
      run: go mod verify

    - name: Run
      shell: bash
      run: |
        sources=$(find src/ -name *.go -not \( -name *_test.go \))
        echo "SVG<<EOF" >> $GITHUB_OUTPUT
        go run $sources ${{ inputs.PR_URL }} ${{ inputs.TOKEN }} >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT
        cat $(echo $GITHUB_OUTPUT)
